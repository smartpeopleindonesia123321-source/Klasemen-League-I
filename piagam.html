<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>PIAGAM PENGHARGAAN | FOOTBALL LEAGUE-I</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700;900&family=Playfair+Display:wght@700;900&family=Libre+Baskerville:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37; --silver: #aaa9ad; --bronze: #cd7f32;
            --dark: #0a0a0a; --white: #ffffff;
        }
        body { background: #222; font-family: 'Kanit', sans-serif; display: flex; flex-direction: column; align-items: center; gap: 50px; padding: 50px 0; }
        
        .certificate {
            width: 800px; height: 560px; background: var(--white);
            position: relative; border: 20px solid var(--dark);
            display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; color: var(--dark);
            margin-bottom: 50px;
        }

        .inner-border { position: absolute; top: 15px; left: 15px; right: 15px; bottom: 15px; border: 2px solid var(--dark); pointer-events: none; }
        .corner { position: absolute; width: 100px; height: 100px; border: 8px solid var(--gold); }
        .top-left { top: 0; left: 0; border-right: none; border-bottom: none; }
        .top-right { top: 0; right: 0; border-left: none; border-bottom: none; }
        .bottom-left { bottom: 0; left: 0; border-right: none; border-top: none; }
        .bottom-right { bottom: 0; right: 0; border-left: none; border-top: none; }

        .trophy-container { height: 115px; margin-top: 5px; display: flex; gap: 15px; align-items: center; justify-content: center; z-index: 5; }
        .trophy-container img {
            height: 100%;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
            mix-blend-mode: multiply; 
        }

        .header { margin-top: 35px; text-transform: uppercase; letter-spacing: 5px; font-weight: 400; font-size: 13px; }
        .award-title { font-family: 'Playfair Display', serif; font-size: 34px; margin: 5px 0; color: var(--gold); text-transform: uppercase; text-align: center; width: 85%; line-height: 1.1; font-weight: 900; }
        
        .presented-to { margin-top: 5px; font-size: 16px; font-style: italic; font-family: 'Libre Baskerville', serif; }
        
        .winner-name { 
            font-family: 'Libre Baskerville', serif; 
            font-size: 42px; 
            font-weight: 700; 
            margin: 5px 0; 
            text-transform: uppercase; 
            color: #111; 
            text-align: center;
            letter-spacing: 2px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
            min-width: 60%;
        }

        .ballon-text {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            font-style: italic;
            color: var(--gold);
            font-size: 18px;
            margin-top: -5px;
            letter-spacing: 1px;
        }

        .league-name { font-weight: 900; color: #1e40af; margin-top: 8px; font-size: 20px; letter-spacing: 1px; }
        .description { width: 80%; text-align: center; font-size: 14px; margin-top: 10px; line-height: 1.4; color: #444; }

        /* MODIFIKASI FOOTER UNTUK TTD & CAP */
        .footer { margin-top: auto; margin-bottom: 20px; display: flex; justify-content: space-around; width: 100%; position: relative; }
        .sig-box { text-align: center; width: 220px; position: relative; display: flex; flex-direction: column; align-items: center; }
        
        .sig-img { height: 65px; width: auto; margin-bottom: -15px; z-index: 2; mix-blend-mode: multiply; }
        
        .stamp-img { 
            position: absolute; 
            width: 100px; 
            height: auto; 
            bottom: 15px; 
            left: 55%; 
            transform: translateX(-20%); 
            z-index: 1; 
            opacity: 0.85; 
            pointer-events: none; 
            mix-blend-mode: multiply;
        }

        .sig-line { border-top: 2px solid var(--dark); width: 100%; padding-top: 5px; font-weight: bold; font-size: 14px; text-transform: uppercase; z-index: 3; }
        .sig-role { font-size: 11px; color: #444; text-transform: none; margin-top: 2px; font-weight: normal; }
        
        .cert-juara2 .award-title { color: var(--silver); } .cert-juara2 .corner { border-color: var(--silver); }
        .cert-juara3 .award-title { color: var(--bronze); } .cert-juara3 .corner { border-color: var(--bronze); }
        .cert-topscorer .award-title { color: #cc0000; } .cert-topscorer .corner { border-color: #cc0000; }
        .cert-poty .award-title { color: #1e40af; } .cert-poty .corner { border-color: #1e40af; }
        .cert-witness .award-title { color: #546e7a; } .cert-witness .corner { border-color: #546e7a; }
        .cert-fairplay .award-title { color: #2e7d32; } .cert-fairplay .corner { border-color: #2e7d32; }

        .btn-print {
            position: fixed; top: 20px; left: 20px; padding: 12px 25px;
            background: #00f2ff; border: none; font-weight: bold; cursor: pointer;
            border-radius: 5px; z-index: 100; font-family: 'Kanit'; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        @media print { 
            body { background: none; padding: 0; gap: 0; } 
            .certificate { box-shadow: none; page-break-after: always; margin: 0; border: 15px solid var(--dark); } 
            .btn-print { display: none; } 
        }
    </style>
</head>
<body>

    <button class="btn-print" onclick="window.print()">üì• SIMPAN PIAGAM (PDF)</button>
    <div id="loading" style="color: white; margin-top: 100px;">üîÑ MEMPROSES DATA...</div>
    <div id="certificates-container"></div>

    <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4v_ziMtwhRpQxS5ZnIbO9olIrUlzAAx8X5kS_Yr-Mv_GqDqSsg4Lc-1YNugRqElvUClbXnsf5gu12/pub?gid=0&single=true&output=csv';

    const NAMA_SAKSI_TERBAIK = "No Valuable Name"; 
    const NAMA_FAIR_PLAY = "No Valuable Name";    

    const assets = {
        piala: 'assets/piala.png',
        emas: 'assets/emas.png',
        perak: 'assets/perak.png',
        perunggu: 'assets/perunggu.png',
        sepatu: 'assets/sepatu.png',
        bola: 'assets/bola.png',
        saksi: 'assets/saksi.png',
        fairplay: 'assets/fairplay.png',
        ttdRegi: 'assets/ttdregi.png',
        ttdRizal: 'assets/ttdrizal.png',
        cap: 'assets/cap.png'
    };

    async function generateCertificates() {
        try {
            const forceUpdate = new Date().getTime();
            const res = await fetch(`${sheetUrl}&t=${forceUpdate}`);
            const csv = await res.text();
            
            let players = csv.split('\n').slice(1).map(line => {
                const row = line.split(',').map(c => c.trim().replace(/"/g, ''));
                return { 
                    nama: row[0], 
                    point: parseInt(row[1]) || 0, 
                    goals: parseInt(row[2]) || 0,
                    potw_winner: parseInt(row[5]) || 0 
                };
            }).filter(p => p.nama);

            const container = document.getElementById('certificates-container');
            container.innerHTML = ""; 
            document.getElementById('loading').style.display = 'none';

            const rankWinners = [...players].sort((a, b) => b.point - a.point || b.goals - a.goals);
            const scorerWinners = [...players].sort((a, b) => b.goals - a.goals);

            const maxPotwValue = Math.max(...players.map(p => p.potw_winner));
            const topPotyWinners = players.filter(p => p.potw_winner === maxPotwValue && maxPotwValue > 0);

            const awards = [
                { type: 'cert-juara1', imgs: [assets.piala, assets.emas], title: '1st PLACE CHAMPION', name: rankWinners[0]?.nama || "N/A", desc: 'Atas prestasi luar biasa menjadi pemuncak klasemen akhir musim.' },
                { type: 'cert-juara2', imgs: [assets.perak], title: '2nd PLACE RUNNER UP', name: rankWinners[1]?.nama || "N/A", desc: 'Atas perjuangan luar biasa meraih posisi kedua pada kompetisi musim ini.' },
                { type: 'cert-juara3', imgs: [assets.perunggu], title: '3rd PLACE WINNER', name: rankWinners[2]?.nama || "N/A", desc: 'Atas keberhasilan menempati posisi tiga besar pada kompetisi musim ini.' },
                { type: 'cert-topscorer', imgs: [assets.sepatu], title: 'GOLDEN BOOT (TOP SCORER)', name: scorerWinners[0]?.nama || "N/A", desc: `Pencetak gol terbanyak dengan koleksi ${scorerWinners[0]?.goals || 0} gol.` }
            ];

            awards.forEach(data => renderCard(container, data));

            topPotyWinners.forEach(winner => {
                renderCard(container, {
                    type: 'cert-poty',
                    imgs: [assets.bola],
                    title: 'PLAYER OF THE YEAR',
                    name: winner.nama,
                    isBallon: true,
                    desc: `Penghargaan tertinggi atas pencapaian individu dan konsistensi performa sebagai pemain terbaik sepanjang musim bergulir.`
                });
            });

            renderCard(container, {
                type: 'cert-witness',
                imgs: [assets.saksi],
                title: 'BEST WITNESS',
                name: NAMA_SAKSI_TERBAIK,
                desc: 'Penghargaan atas dedikasi dan integritas dalam menyaksikan serta mengawasi setiap prosedur kompetisi agar berjalan sesuai regulasi.'
            });

            renderCard(container, {
                type: 'cert-fairplay',
                imgs: [assets.fairplay],
                title: 'FAIR PLAY TROPHY',
                name: NAMA_FAIR_PLAY,
                desc: 'Penghargaan ini diberikan kepada individu yang menunjukkan perilaku sportif, disiplin tinggi, menghormati lawan, serta mematuhi peraturan permainan.'
            });

        } catch (e) { 
            console.error("Waduh error, Bro:", e); 
            document.getElementById('loading').innerText = "‚ùå GAGAL MEMUAT DATA!";
        }
    }

    function renderCard(container, data) {
        let imagesHTML = data.imgs && data.imgs.length > 0 
            ? data.imgs.map(url => `<img src="${url}" alt="award">`).join('') 
            : `<div style="font-size: 80px; margin-bottom: 10px; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));">${data.customIcon || 'üèÜ'}</div>`;
            
        let extraText = data.isBallon ? `<div class="ballon-text">üèÜ Ballon d'Or Winner üèÜ</div>` : '';

        container.innerHTML += `
            <div class="certificate ${data.type}">
                <div class="inner-border"></div>
                <div class="corner top-left"></div><div class="corner top-right"></div>
                <div class="corner bottom-left"></div><div class="corner bottom-right"></div>
                
                <div class="header">Official Achievement</div>
                <div class="award-title">${data.title}</div>
                
                <div class="trophy-container">
                    ${imagesHTML}
                </div>

                <div class="presented-to">Diberikan Kepada:</div>
                <div class="winner-name">${data.name}</div>
                ${extraText}
                <div class="league-name">FOOTBALL LEAGUE-I</div>
                
                <div class="description">${data.desc}</div>
                
                <div class="footer">
                    <div class="sig-box">
                        <img src="${assets.ttdRegi}" class="sig-img" alt="TTD">
                        <div class="sig-line">Regi Hidayat Putra</div>
                        <div class="sig-role">Official Admin</div>
                    </div>
                    <div class="sig-box">
                        <img src="${assets.cap}" class="stamp-img" alt="CAP">
                        <img src="${assets.ttdRizal}" class="sig-img" alt="TTD">
                        <div class="sig-line">Rizal Amar</div>
                        <div class="sig-role">League Manager</div>
                    </div>
                </div>
            </div>
        `;
    }

    generateCertificates();
    </script>
</body>
</html>
